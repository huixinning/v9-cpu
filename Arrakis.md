# Arrakis: The Operating System is the Control Plane

### 回新宁 2015210865 白帅 P15240002

> Peter, S., Li, J., Zhang, I., Ports, D. R., Woos, D., Krishnamurthy, A., ... & Roscoe, T. (2015). Arrakis: The operating system is the control plane. ACM Transactions on Computer Systems (TOCS), 33(4), 11.

如今的数据中心中有大量对I/O敏感的应用，包括文件系统I/O和网络I/O。 提高I/O性能会对这些应用产生显著的影响。 另一方面，物理的I/O设备性能已经很高而且价格也在可以接受的范围内，也就是说性价比很高了。 能不能让实际应用的性能更接近物理设备的性能？ 这就是这篇文章的一个出发点

在Linux系统在一个完整的数据通路中，Kernel担当了太多的角色，它负责各个进程的隔离保护、数据从I/O设备到应用空间的拷贝、I/O处理与I/O调度、访问控制、资源限制等等。 而在硬件操作所占的时间只有很少一部分。如果只是简单的替换更高性能的I/O设备，对于整个数据通路消耗的总时间没有明显的性能提升。调整内核在数据通路的角色才是更加有效的一种优化方式。

在这篇文章中，作者提出了Arrakis，这个将操作系统中数据通路分离成两个部分的架构。数据直接从I/O设备到应用层，操作系统只扮演控制角色。 Arrakis保持原有内核数据通路中的一些特性：隔离保护，资源限制，灵活的I/O协议，全局命名空间 通过大量使用硬件特性支持这一架构的实现。 主要使用了网卡和RAID板卡的虚拟化特性，网卡虚拟化技术已经比较成熟并形成标准。RAID卡虚拟化技术也在逐步发展。 在支持虚拟化的网卡中，通过Single-Root I/O Virtualization特性支持在一个物理设备上虚拟多个网卡实例，并且支持不同的网卡实例绑定到不同的端口上。并且通过IOMMU管理每个虚拟设备的内存空间，实现多个实例的隔离保护。进一步，网卡还支持过滤器，高级的网卡能够支持过滤报头的所有字段。在磁盘设备上，支持虚拟存储区的特性，能够实现应用的存储相互分离，并且通过内核IPC调用实现文件共享。 网卡控制器和虚拟存储控制器也支持一定的资源限制和调度。

让数据通路绕过内核，首先是上面讲到的在I/O设备上能够直接完成的功能从内核中分离至I/O设备。 由协议栈负责提供的API和I/O处理移到用户空间完成。 至保留内核对于I/O的管理功能。管理只需要在I/O使用之前进行配置，具体的数据不经过内核。

通过这样的功能划分，Arrakis获得了很好的I/O性能提升。在实验对比中，Redis服务的吞吐量有了9倍的提高，memcached的扩展性也有很好的提升，在4个和上的吞吐量有3倍的提高。
